<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Fanas</title>
    </head>
    <body>
        <h1>FANAS</h1>
        <h3>Snow White and the Seven Dwarfs</h3>    
        <label for="chapters">Chapter:</label>
        <select name="chapters" id="chapters" >
            <option value="0" selected>0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
        <br><br>
        <button id="submit-button">Change</button>
        <br><br>
        <audio id="audioPlayer" controls>
            <!-- <source src="/audio" type="audio/mpeg">
            Your browser does not support the audio element. -->
        </audio>

        <br>
        <button id="skip-back-button">Skip -10s</button>        
        <button id="skip-next-button">Skip 10s</button>
    </body>
        
    <script type="module">
        async function fetchAudioUrl() {
            try {
                const response = await fetch('/get-audio-url?chapters=' + 
                                document.getElementById("chapters").value);
                const data = await response.json();
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = data.url;
            } catch (error) {
                console.error('Error fetching audio URL:', error);
            }
        }
    
        fetchAudioUrl();

        document.getElementById('submit-button').addEventListener('click', () => {
            fetchAudioUrl();
        });

        document.getElementById('skip-back-button').addEventListener('click', () => {
            var audio = document.getElementById('audioPlayer');
            audio.currentTime -= 10; // Skip forward 10 seconds
        });
        document.getElementById('skip-next-button').addEventListener('click', () => {
            var audio = document.getElementById('audioPlayer');
            audio.currentTime += 10; // Skip forward 10 seconds
        });

        var audioElement = document.getElementById('audioPlayer');

        if ('mediaSession' in navigator) {
            navigator.mediaSession.metadata = new MediaMetadata({
                title: 'Song Title',
                artist: 'Artist Name',
                album: 'Album Name'
            });

            navigator.mediaSession.setActionHandler('play', () => {
                audioElement.play();
            });

            navigator.mediaSession.setActionHandler('pause', () => {
                audioElement.pause();
            });

            // audioElement.addEventListener('play', () => {
            //     navigator.mediaSession.playbackState = 'playing';
            // });

            // audioElement.addEventListener('pause', () => {
            //     navigator.mediaSession.playbackState = 'paused';
            // });
        }
    </script>
</html>
